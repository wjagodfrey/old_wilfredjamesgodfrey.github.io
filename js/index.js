// Generated by CoffeeScript 1.7.1
(function() {
  var entities, events, fireEvent, frame, frameCount, frameIndex, gameCanvas, gameCq, group, groupName, loaded, loadedFrameCount, mouse, onEvent, resizeFactor, root, sprite, spriteName, sprites, _fn, _ref, _ref1,
    __slice = [].slice;

  events = {};

  onEvent = function(eventName, eventHandler) {
    if (events[eventName] == null) {
      events[eventName] = [];
    }
    events[eventName].push(eventHandler);
    return function() {
      return events[eventName].splice(events[eventName].indexOf(eventHandler), 1);
    };
  };

  fireEvent = function() {
    var args, eventHandler, eventName, _i, _len, _ref, _ref1, _results;
    eventName = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
    if ((_ref = events[eventName]) != null ? _ref.length : void 0) {
      _ref1 = events[eventName];
      _results = [];
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        eventHandler = _ref1[_i];
        _results.push(eventHandler.apply(null, args));
      }
      return _results;
    }
  };

  this.sprites = sprites = {
    "face": {
      "actions": {
        "skin": {
          "frames": ["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAA6CAYAAADGFcvAAAABNklEQVRoQ+3aUQ6CMAwGYHcI7+WFfPJC3stDaEbSZQKja9fB36Q+A375qWO2pNvg5/N+fSWXuD+eSXI8Has6SYpbwzRYEXQU2EqyB94NnYUkPIdlobOBdcpH2EPomUgO3IRehWyVAiw0g+tS2IVeneZeGWygSMi6DHxCEdOkWi2JoiI3z3oXUHRkTnW59QHVbDwb50SihmEul0oe6jOg1rc9Eo1EZyRgfc1YnswTjU2JcaSxKTEONDbOpoHmjomLGi1Q9CXKJxQ1Vero/fWeEP+WuIAe9keRUnUBXQ8eYPujLBTl1+8CujdvgpyKuIC2pndQiboZMaqhZ64ALqbLHLL08Lnt+MzHag+yGzqrBHqRIqg1VoIUQ62wUqQKSvWsrVsNcggqTVcLpGDYl1+4FYEDjwLp+39qHtWc5f6nZgAAAABJRU5ErkJggg==", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACYAAAAzCAYAAAD7JnqGAAABJUlEQVRYR+3Z4Q0CIQwFYFnArZzJGZzJrVxAwyUQxAJtOcozqX/l9Mu7AkcvXCY+r+fjPbr8eruH0Rjqe/FFHAz1R1IgG6YF1UgukAU7C1UiR8AhbAUqAXu4JmwliJMcCbNC9ZL7gVmjWjgYWASWNfcF25UWlVqG7UbVOGwYSlplakdiDmM+ZsTZCZlY9Ae025hCdRizvPIwT8wTkyYgHe815olJE5COx90rER97jk0cEQb72JNhaKk5TLJUpEMv1IG3PI1Dwf6rRZDqYNfhpG7iQfTH6k5PXvnrWWOdGtXy3N7qpNJqJma5E7QaxN2u9epbqupaW8xSSNj0C4gV9TZCdYt/1RLCQYlgZyTHRYlhMzgJSgXT4KQoNaysv95apwGl3/4APZLBGq6++gkAAAAASUVORK5CYII=", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAuCAYAAAA/SqkPAAAA6UlEQVRYR+2Y4Q3EIAiF61rd6ibpVrdWL5poelYEioBJ7W/tx3u0BAgb8zm/x9m6EvZP4LyKfBgC1jBqACiYCuQG0AU/heYgeupBsBSKwZvgUdAe/AYeDYXgZuAYwDXnf2AttS3VBawNreG+YCu1V9VJ8WvA6Qv3UJzA1jaXPC8wp4uQnF05lrjHurusZtklOexXMj1qdWyBXBS/GGyZ59zi+jZ7root4HNNErn8abZCoGJNu+shfZ75WMPy1kpirlXESNXQAma+rY9UNbZoQxds3F8MA5bZido3UQoLFVrGVCocUs8BZtYPRA2vZuRC5CMAAAAASUVORK5CYII="]
        },
        "mouth": {
          "frames": ["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAECAYAAABodtTSAAAAJklEQVQYV2M8VJrz3657CiMDmQCkH6yZXINg+qhnCMw1pPoIFgwAmXMap4CjQnIAAAAASUVORK5CYII=", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAACCAYAAACHSIaUAAAAH0lEQVQIW2M8VJrz3657CiMDiQCkD6wJxCBRLwPIQgATpgqlQ0dZqgAAAABJRU5ErkJggg==", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAEElEQVQIW2M8VJrzn4FCAACvSAKkaqtKXQAAAABJRU5ErkJggg==", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAACCAYAAAC+LzfPAAAAIUlEQVQIW2NkAIJDpTn/QTQ5wK57CiMjyAAQgxwDYA4AAMg1CqWvauu0AAAAAElFTkSuQmCC", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAECAYAAABV5LW0AAAAK0lEQVQIW2NkgIJDpTn/YWxctF33FEaQHJgAaYAJ4NMIU8dIrAZkF5GlCQAGahlJD4Y4xQAAAABJRU5ErkJggg=="]
        },
        "ears": {
          "frames": ["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAANCAYAAADWgVyvAAAAYklEQVRIS2N8sKL2PwMSUIhoZkTmDxY2ujsZ0QVADh1sjsfmRqwOH0yOx+ZokPtGHU6rvDAa4rQKWVzmjob4aIgTGQI4kwpI/2CuhHC5DVy9D/ZqH5v74O0SZMnBXOXD3AYA/OpeNv4mjFoAAAAASUVORK5CYII="]
        },
        "nose": {
          "frames": ["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAPCAYAAADZCo4zAAAAcUlEQVQYV2NkQAKvNzT/B3FFA2oZYcJwBkiAaAXIpmCYcP3oSwZNa3G4NXAFMOPxKgBJggBOE3AqQDYeZgLMoWA3UKYAXTcsBGEOZcSnAKQYrADmeuR4gTkWHlCHSnPAEQUDdt1TwHIoQQ1TBJMEKQAAc3FYStOrSO4AAAAASUVORK5CYII="]
        },
        "eye_whites": {
          "frames": ["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAFCAYAAACuNHcwAAAAK0lEQVQYV2NkAIKnT+/9B9EwIC2txIjMJ4aNzQxGdEFyLMBlxhA2nJZhDgCkOCb7SrxlvQAAAABJRU5ErkJggg=="]
        },
        "pupils": {
          "frames": ["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAABCAYAAADTjP5iAAAAFklEQVQIW2M0MzP7f+rUKUYGCgDIDAAUCgWjuVjQ7AAAAABJRU5ErkJggg==", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAECAYAAABhnXSoAAAAKklEQVQYV2NkAAIzM7P/IPrUqVOMIJocgGwGI4wDM4gcg9HNoI2htPA+AIo1G0cHpildAAAAAElFTkSuQmCC"]
        },
        "eyebrows": {
          "frames": ["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAACCAYAAACpDacGAAAAKElEQVQIW2NkQAKhrpb/kfmrdx9nROYTw0Y2A10/I7oF6AaSYiEhswCsPw3VDopBvwAAAABJRU5ErkJggg==", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAICAYAAAAIloRgAAAAWUlEQVQoU2NkIABCXS3/r959nJGQOmLkcRoCsgRkALEWEeMoDMtglpBiEcxXhByIYhkhxcQEFT7Hgi2jxDe4HIDN4YzU8A2xFlIlleELXmTP0NwyWDSBUjUAx2E0CURot4sAAAAASUVORK5CYII=", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAHCAYAAADj/NY7AAAASklEQVQoU2MMdbX8zwAEq3cfZwTR1AAwM8EGUtMCZLPgroUJUuILdEdiBAU5vsDlMKzhTIoF+NTijESQJkKRTMgReFMIPguIsRwACzU12k7DDSsAAAAASUVORK5CYII="]
        },
        "eyelids": {
          "frames": ["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAHCAYAAAD9NeaIAAAAOUlEQVQoU2NkgILXG5r/w9ggWjSglhGZTwwblxlgg9AlYQaSYhE+MxhxSZJiESEzhpEldIkTeqQuAFv0NV9Bp5PrAAAAAElFTkSuQmCC", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAHCAYAAADnCQYGAAAAKklEQVQoU2N8vaH5PwMSEA2oZUTmE8NGN4NkA4ixZNRQYkKJNDWMtIh9AAo+DkJjIYPbAAAAAElFTkSuQmCC", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAHCAYAAADj/NY7AAAANUlEQVQoU2NkAILXG5r/g2gYEA2oZUTmE8PGZgYjuiA5FuAyg2QXEuMLmJohbDjNw5xWqQUARPAeQlFRGIkAAAAASUVORK5CYII=", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAHCAYAAAD9NeaIAAAARUlEQVQoU2NkgILXG5r/w9ggWjSglhGZTwwblxkkG0SMZehqhpEl6OGI7lVi4oaQGeDgwqWIGAtwJRyYOMgMeJzQMnUBAJnsHyXwfP54AAAAAElFTkSuQmCC", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAHCAYAAAD9NeaIAAAAPklEQVQoU2NkgILXG5r/w9ggWjSglhGZTwwblxlgg9AlYQaSYhE+MxhxSZJiESEzSA4SYoINXc0wtISWqQsA19wfJbZ8PhMAAAAASUVORK5CYII=", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAHCAYAAAD9NeaIAAAAQUlEQVQoU2NkgILXG5r/w9ggWjSglhGZTwwblxlgg9AlYQaSYhE+MxhxSZJiESEzSA4SYoINXQ39fELzOKFH6gIAI34uQka/i+sAAAAASUVORK5CYII=", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAHCAYAAAD9NeaIAAAAQUlEQVQoU2NkgILXG5r/w9ggWjSglhGZTwwblxlgg9AlYQaSYhE+M0h2LTE+QlfDiMsFpPiGkBn0sYSucULL1AUAVOAuQlDkeFQAAAAASUVORK5CYII=", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAHCAYAAAD9NeaIAAAAQElEQVQoU2NkgILXG5r/w9ggWjSglhGZTwwblxkkG0SMZehqwJaguwCmiBTf4DODEZckKRYRMoM+ltAluOiRugAssy5Csr2zKgAAAABJRU5ErkJggg==", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAHCAYAAAD9NeaIAAAAPklEQVQoU2NkgILXG5r/w9ggWjSglhGZTwwblxlgg9AlYQaSYhE+MxhxSZJiESEz6GMJMWFNqRr6xAk9UhcA8g0uQjqOE4QAAAAASUVORK5CYII=", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAHCAYAAAD9NeaIAAAAQUlEQVQoU2NkgILXG5r/w9ggWjSglhGZTwwblxlgg9AlYQaSYhE+MxhxSZJiESEz6GMJXYKLmAilVA08BdEydQEAGkkuQv+5iYsAAAAASUVORK5CYII="]
        },
        "backboard": {
          "frames": ["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEwAAABYCAYAAABf0BGmAAADYUlEQVR4Xu2czVEDMQyFSR0c4EILXKiDOqiFGaqiBS5woI4wBpxxHFl68l+8K3EMtiN/+/Qsezd7uFnw7+Xx/vj6/nlYMLSbpYIKoFJIK0JbAlgOKlfWTHBpLNT3ksBipxmBSrBmKK4UgxpYCHYENA7Sw93tidHH1zdrY71i4+LJv+NCYZrOGlOWlJSCyseVwGkvLBpL/N4U2glYOkgMngsUubpvz09HabIcqBpwmouYt6ViyaGxwNIBpYlrA9WAosaeGU8K7RcYpS4OQGuwrbCQi4PEKMWRjxGy6gyYNEAMFAmGmhQ6PgJkRhtqnoeorq1NZjQwCtavwvIVw8H9XQoqHcPnFx4WPnRo58DgsmK07Fcdv6Suk8Ji4NrVctUJt8aVAlNV+hZTk1PXhcJcaWWzj2zY0wprC4CkLkhhlqBVA6vZLrUa7Qr9ObNnUzIHZkVlTcCsqQxJx6KHWVwtHZjSFB2YAljpZIIagr3NZmWrhKrLPexfQg5MkY6hqQNzYEoCyuauMAemJKBs7gprBBa6l+7sex1GrJJVwCzdfutS6VsCpqnFiilpZVsU7Q41fgdW2B6VfEy8CWLltBVNSweWlCBIWorALN3MdWCNBWzVU9SWFIb4mKdkpkIpLR2YA1MaF9Fc9bhT6G+tys+ZwQ/UxY4O7PwnO+QjmxQsS1U+pzIHBthcycfEH2dZq8Oo0wtXWE+F+Sr5RxNOSQfmwIAEvGxSrTCrpYUDU+isqdK3qDD1XtK68TcDs6SyqvOwXGFWgEmwAgfovmT0y71vk5qAWVMZ+nwF/PTOnlWGwmJTsnQ+tkc/Q1Ix8hBfh0W9p2ZPXqZRF6Qwysv2ojItLNPAKFgBiPQSJjEl9+hltbBghe0pLVtgqYDtAVorLDWwrRazJVCIZ+WnQrCHpR239sBwD2XBdVjp3G0L0HoqqxnYFtKzp7K6AFsZ2ghYVaZPpehq6VlTwZesp4vp54Osst8cpap0vlWrJKKy2GbWRn2kqoYA47ZQIzfrM1Q1FFhpRzAC2mxY3Uxfk6I9UvUaoLqVFdLqgr4oWxon/v+asIYqjNtK5XCQhWFE1Y5epOEehm6nUHAcrDCGdOhXA6bUp1tZoQ1KSlVpvJmQrqawmsUh73MtUNNMX1KKVL/NTjkp3h8CAYw7WNy/OgAAAABJRU5ErkJggg=="]
        }
      }
    },
    "hand": {
      "actions": {
        "point": {
          "frames": ["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAQCAYAAAAiYZ4HAAAAWElEQVQoU2NkwAL+//n1n5GFjRGbHIYgSDFI4agGpODCGUrIQYocYkRpgGkGaWSEhTss7JH5OCOOkCIU58E4xGqC+4FkDSCbiNFEUiiBAwZX8sYaQsBgBQAUlUPJtd8APQAAAABJRU5ErkJggg==", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAQCAYAAAAiYZ4HAAAAWUlEQVQoU2NkIBEwkqieAauG/39+/WdkYcMqhyEIUgyydThoQA49ZP/g9DS24AZpZISFCixkkPlYNYEECSlCcR6MQ6wmuB9I1kCs00gKJXDAYAsJXM4DBSsA6+07yaebvjcAAAAASUVORK5CYII="]
        }
      }
    }
  };

  root = this;

  loaded = false;

  frameCount = 0;

  loadedFrameCount = 0;

  this.e = entities = [];

  for (spriteName in sprites) {
    sprite = sprites[spriteName];
    _ref = sprite.actions;
    for (groupName in _ref) {
      group = _ref[groupName];
      _ref1 = group.frames;
      _fn = function(spriteName, sprite, groupName, group, frameIndex, frame) {
        var img;
        frameCount++;
        img = document.createElement('img');
        img.onload = function() {
          console.log(spriteName, groupName, frameIndex);
          group.frames[frameIndex] = img;
          loadedFrameCount++;
          if (frameCount === loadedFrameCount) {
            loaded = true;
            console.log('loaded', sprites);
            return fireEvent('assetsLoaded');
          }
        };
        return img.src = frame;
      };
      for (frameIndex in _ref1) {
        frame = _ref1[frameIndex];
        _fn(spriteName, sprite, groupName, group, frameIndex, frame);
      }
    }
  }

  onEvent('assetsLoaded', function() {
    var face;
    return entities.push(this.face = face = {
      x: window.innerWidth / 2,
      y: window.innerHeight / 2,
      focal: {
        x: window.innerWidth / 2,
        y: window.innerHeight / 2
      },
      headSpeed: 10,
      a: {
        backboard: sprites.face.actions.backboard.frames,
        skin: sprites.face.actions.skin.frames,
        mouth: sprites.face.actions.mouth.frames,
        ears: sprites.face.actions.ears.frames,
        nose: sprites.face.actions.nose.frames,
        eye_whites: sprites.face.actions.eye_whites.frames,
        pupils: sprites.face.actions.pupils.frames,
        eyebrows: sprites.face.actions.eyebrows.frames,
        eyelids: sprites.face.actions.eyelids.frames
      },
      s: {
        eyelids: 'half',
        eyebrows: 'flat',
        mouth: 'flat',
        pupils: 'small'
      },
      f: {
        eyebrows: 0,
        pupils: 0,
        mouth: 2,
        eyelids: 0
      },
      b: {
        blinking: true,
        duration: 5,
        interval: 1,
        frame: 0,
        startNew: function() {
          var blinkTime;
          blinkTime = 3000 + (Number((Math.random()).toFixed(1))) * 10000;
          this.duration = 1 + (Number((Math.random()).toFixed(1))) * 5;
          if ((Number((Math.random()).toFixed(1))) < 0.7) {
            this.interval = 0;
          } else {
            this.interval = (Number((Math.random()).toFixed(1))) * 5;
          }
          return setTimeout((function(_this) {
            return function() {
              return _this.blinking = true;
            };
          })(this), blinkTime);
        }
      },
      update: function() {
        if (!this.headSpeed) {
          this.headSpeed = 1;
        }
        this.focal.x += (mouse.x - this.focal.x) / this.headSpeed;
        return this.focal.y += (mouse.y - this.focal.y) / (this.headSpeed * 1.6);
      },
      draw: function(ctx) {
        var earPax, eyeOffset, eyeballPax, eyebrowOffset, middleSkinPax, mouthOffset, noseOffset, nosePax, pax, pupilPax, topSkinPax;
        pax = {
          x: (this.focal.x - gameCanvas.width / 2) / gameCanvas.width / 2,
          y: (this.focal.y - gameCanvas.height / 2) / gameCanvas.height / 2
        };
        eyebrowOffset = -10 * resizeFactor;
        eyeOffset = -4 * resizeFactor;
        noseOffset = 5 * resizeFactor;
        mouthOffset = 15 * resizeFactor;
        earPax = -4;
        middleSkinPax = 5;
        topSkinPax = 8;
        eyeballPax = 10;
        nosePax = 15;
        pupilPax = 17;
        if (this.a.eyebrows[this.f.eyebrows] == null) {
          this.f.eyebrows = 0;
        }
        if (this.a.pupils[this.f.pupils] == null) {
          this.f.pupils = 0;
        }
        if (this.a.mouth[this.f.mouth] == null) {
          this.f.mouth = 0;
        }
        if (this.a.eyelids[this.f.eyelids] == null) {
          this.f.eyelids = 0;
        }
        if (this.s.eyelids === 'open') {
          this.f.eyelids = 1;
        } else if (this.s.eyelids === 'closed') {
          this.f.eyelids = 0;
        } else if (this.s.eyelids === 'squint') {
          this.f.eyelids = 5;
          if (pax.y < -0.05) {
            this.f.eyelids = 6;
            if (pax.y < -0.2) {
              this.f.eyelids = 7;
            }
          }
          if (pax.y > 0.05) {
            this.f.eyelids = 8;
          }
        } else if (this.s.eyelids === 'half') {
          this.f.eyelids = 2;
          if (pax.y < -0.07) {
            this.f.eyelids = 3;
          }
          if (pax.y > 0.07) {
            this.f.eyelids = 4;
          }
        }
        if (this.s.pupils === 'small') {
          this.f.pupils = 0;
        } else if (this.s.pupils === 'large') {
          this.f.pupils = 1;
        }
        if (this.s.eyebrows === 'flat') {
          this.f.eyebrows = 0;
        } else if (this.s.eyebrows === 'peak') {
          this.f.eyebrows = 1;
        } else if (this.s.eyebrows === 'valley') {
          this.f.eyebrows = 2;
        }
        if (this.s.mouth === 'joyful') {
          this.f.mouth = 0;
        } else if (this.s.mouth === 'happy') {
          this.f.mouth = 1;
        } else if (this.s.mouth === 'flat') {
          this.f.mouth = 2;
        } else if (this.s.mouth === 'sad') {
          this.f.mouth = 3;
        } else if (this.s.mouth === 'sorrowful') {
          this.f.mouth = 4;
        }
        if (this.f.pupils === 1) {
          pupilPax = 13;
        }
        if (this.b.blinking) {
          this.b.frame++;
          if (this.b.frame > this.b.duration * (this.b.interval ? 2 : 1) + this.b.interval) {
            this.b.blinking = false;
            this.b.frame = 0;
            this.b.startNew();
          } else if (this.b.frame > this.b.duration + this.b.interval && this.b.interval) {
            this.f.eyelids = 0;
          } else if (this.b.frame > this.b.duration) {
            false;
          } else {
            this.f.eyelids = 0;
          }
        }
        return ctx.save().translate(gameCanvas.width / 2 - this.a.backboard[0].width * resizeFactor / 2, gameCanvas.height / 2 - this.a.backboard[0].height * resizeFactor / 2).drawImage(this.a.backboard[0], 0, 0, this.a.backboard[0].width, this.a.backboard[0].height, 0, 0, this.a.backboard[0].width * resizeFactor, this.a.backboard[0].height * resizeFactor).restore().save().translate((gameCanvas.width / 2 - this.a.ears[0].width * resizeFactor / 2) + earPax * resizeFactor * pax.x, (gameCanvas.height / 2 - this.a.ears[0].height * resizeFactor / 2) + earPax * resizeFactor * pax.y).drawImage(this.a.ears[0], 0, 0, this.a.ears[0].width, this.a.ears[0].height, 0, 0, this.a.ears[0].width * resizeFactor, this.a.ears[0].height * resizeFactor).restore().save().translate(gameCanvas.width / 2 - this.a.skin[0].width * resizeFactor / 2, gameCanvas.height / 2 - this.a.skin[0].height * resizeFactor / 2).drawImage(this.a.skin[0], 0, 0, this.a.skin[0].width, this.a.skin[0].height, 0, 0, this.a.skin[0].width * resizeFactor, this.a.skin[0].height * resizeFactor).restore().save().translate((gameCanvas.width / 2 - this.a.skin[1].width * resizeFactor / 2) + middleSkinPax * resizeFactor * pax.x, (gameCanvas.height / 2 - this.a.skin[1].height * resizeFactor / 2) + middleSkinPax * resizeFactor * pax.y).drawImage(this.a.skin[1], 0, 0, this.a.skin[1].width, this.a.skin[1].height, 0, 0, this.a.skin[1].width * resizeFactor, this.a.skin[1].height * resizeFactor).restore().save().translate((gameCanvas.width / 2 - this.a.skin[2].width * resizeFactor / 2) + topSkinPax * resizeFactor * pax.x, (gameCanvas.height / 2 - this.a.skin[2].height * resizeFactor / 2) + topSkinPax * resizeFactor * pax.y).drawImage(this.a.skin[2], 0, 0, this.a.skin[2].width, this.a.skin[2].height, 0, 0, this.a.skin[2].width * resizeFactor, this.a.skin[2].height * resizeFactor).restore().save().translate((gameCanvas.width / 2 - this.a.eye_whites[0].width * resizeFactor / 2) + eyeballPax * resizeFactor * pax.x, (gameCanvas.height / 2 - this.a.eye_whites[0].height * resizeFactor / 2 + eyeOffset) + eyeballPax * resizeFactor * pax.y).drawImage(this.a.eye_whites[0], 0, 0, this.a.eye_whites[0].width, this.a.eye_whites[0].height, 0, 0, this.a.eye_whites[0].width * resizeFactor, this.a.eye_whites[0].height * resizeFactor).restore().save().translate((gameCanvas.width / 2 - this.a.pupils[this.f.pupils].width * resizeFactor / 2) + pupilPax * resizeFactor * pax.x, (gameCanvas.height / 2 - this.a.pupils[this.f.pupils].height * resizeFactor / 2 + eyeOffset) + pupilPax * resizeFactor * pax.y).drawImage(this.a.pupils[this.f.pupils], 0, 0, this.a.pupils[this.f.pupils].width, this.a.pupils[this.f.pupils].height, 0, 0, this.a.pupils[this.f.pupils].width * resizeFactor, this.a.pupils[this.f.pupils].height * resizeFactor).restore().save().translate((gameCanvas.width / 2 - this.a.eyelids[this.f.eyelids].width * resizeFactor / 2) + eyeballPax * resizeFactor * pax.x, (gameCanvas.height / 2 - this.a.eyelids[this.f.eyelids].height * resizeFactor / 2 + eyeOffset) + eyeballPax * resizeFactor * pax.y).drawImage(this.a.eyelids[this.f.eyelids], 0, 0, this.a.eyelids[this.f.eyelids].width, this.a.eyelids[this.f.eyelids].height, 0, 0, this.a.eyelids[this.f.eyelids].width * resizeFactor, this.a.eyelids[this.f.eyelids].height * resizeFactor).restore().save().translate((gameCanvas.width / 2 - this.a.mouth[this.f.mouth].width * resizeFactor / 2) + topSkinPax * resizeFactor * pax.x, (gameCanvas.height / 2 - this.a.mouth[this.f.mouth].height * resizeFactor / 2 + mouthOffset) + topSkinPax * resizeFactor * pax.y).drawImage(this.a.mouth[this.f.mouth], 0, 0, this.a.mouth[this.f.mouth].width, this.a.mouth[this.f.mouth].height, 0, 0, this.a.mouth[this.f.mouth].width * resizeFactor, this.a.mouth[this.f.mouth].height * resizeFactor).restore().save().translate((gameCanvas.width / 2 - this.a.nose[0].width * resizeFactor / 2) + nosePax * resizeFactor * pax.x, (gameCanvas.height / 2 - this.a.nose[0].height * resizeFactor / 2 + noseOffset) + nosePax * resizeFactor * pax.y).drawImage(this.a.nose[0], 0, 0, this.a.nose[0].width, this.a.nose[0].height, 0, 0, this.a.nose[0].width * resizeFactor, this.a.nose[0].height * resizeFactor).restore().save().translate((gameCanvas.width / 2 - this.a.eyebrows[this.f.eyebrows].width * resizeFactor / 2) + topSkinPax * resizeFactor * pax.x, (gameCanvas.height / 2 - this.a.eyebrows[this.f.eyebrows].height * resizeFactor / 2 + eyebrowOffset) + topSkinPax * resizeFactor * pax.y).drawImage(this.a.eyebrows[this.f.eyebrows], 0, 0, this.a.eyebrows[this.f.eyebrows].width, this.a.eyebrows[this.f.eyebrows].height, 0, 0, this.a.eyebrows[this.f.eyebrows].width * resizeFactor, this.a.eyebrows[this.f.eyebrows].height * resizeFactor).restore();
      }
    });
  });

  onEvent('assetsLoaded', function() {
    var hand;
    onEvent('onmousedown', function() {
      return hand.f.point = 1;
    });
    onEvent('onmouseup', function() {
      return hand.f.point = 0;
    });
    return entities.push(this.hand = hand = {
      x: window.innerWidth / 2,
      y: window.innerHeight / 2,
      a: {
        point: sprites.hand.actions.point.frames
      },
      f: {
        point: 0
      },
      s: 'open',
      draw: function(ctx) {
        return ctx.save().translate(mouse.x - this.a.point[this.f.point].width * (resizeFactor / 2) / 2, mouse.y - this.a.point[this.f.point].height * (resizeFactor / 2) / 2).drawImage(this.a.point[this.f.point], 0, 0, this.a.point[this.f.point].width, this.a.point[this.f.point].height, 0, 0, this.a.point[this.f.point].width * (resizeFactor / 2), this.a.point[this.f.point].height * (resizeFactor / 2)).restore();
      }
    });
  });

  frame = 0;

  resizeFactor = 2;

  this.mouse = mouse = {
    x: root.innerWidth / 2,
    y: root.innerHeight / 2
  };

  gameCq = cq().framework({
    onresize: function(width, height) {
      this.canvas.width = width;
      this.canvas.height = height;
    },
    onmouseup: function(x, y, btn) {
      return fireEvent('onmouseup', x, y, btn);
    },
    onmousedown: function(x, y, btn) {
      return fireEvent('onmousedown', x, y, btn);
    },
    onmousemove: function(x, y) {
      return mouse = {
        x: x,
        y: y
      };
    },
    onkeydown: function(key) {},
    onkeyup: function(key) {},
    onrender: function(delta, time) {
      var entity, i, resizeMargin;
      if (loaded) {
        frame++;
      }
      this.clear('#c6d191');
      this.context.mozImageSmoothingEnabled = this.context.webkitImageSmoothingEnabled = this.context.msImageSmoothingEnabled = this.context.imageSmoothingEnabled = false;
      resizeMargin = 7;
      resizeFactor = Math.min(gameCanvas.height / 60 - resizeMargin, gameCanvas.width / 50 - resizeMargin);
      if (resizeFactor < 2) {
        resizeFactor = 2;
      }
      for (i in entities) {
        entity = entities[i];
        if (typeof entity.update === "function") {
          entity.update();
        }
        if (typeof entity.draw === "function") {
          entity.draw(this, delta, time, parseInt(i));
        }
      }
    }
  }).appendTo('body');

  gameCanvas = gameCq.canvas;

}).call(this);
